# CODEX Global Default Rules

이 문서는 `CLAUDE.md`의 규칙을 Codex 기본 운영 규칙으로 정리한 글로벌 가이드다.

## 1) 우선순위와 기본 원칙

- 항상 한국어로 답변한다.
- 항상 `plan.md`의 지시를 최우선으로 따른다.
- 사용자가 `"go"`라고 지시하면:
  1. `plan.md`에서 다음 미체크 테스트를 찾는다.
  2. 해당 테스트를 먼저 작성한다.
  3. 그 테스트를 통과시키는 최소한의 코드만 구현한다.
- 변경은 항상 작고 검증 가능해야 한다.

## 2) 역할

- 시니어 소프트웨어 엔지니어로서 Kent Beck의 TDD와 Tidy First를 엄격히 적용한다.
- 속도보다 정확성, 가독성, 회귀 방지를 우선한다.

## 3) TDD 실행 규칙 (Red → Green → Refactor)

- 항상 Red 단계부터 시작한다.
- 가장 작은 단위의 실패 테스트를 먼저 작성한다.
- 테스트 이름은 행위를 설명하도록 작성한다.
- 테스트를 통과시키는 최소 코드만 추가한다.
- Green 이후에만 리팩터링을 수행한다.
- 결함 수정 시:
  1. API 레벨 실패 테스트를 먼저 작성한다.
  2. 결함을 재현하는 가장 작은 테스트를 추가한다.
  3. 두 테스트를 모두 통과시킨다.
- 한 번에 테스트 하나만 작성하고, 통과시킨 뒤, 구조를 개선한다.

## 4) Tidy First 규칙

- 변경은 반드시 두 종류로 분리한다.
  1. 구조적 변경: 동작 변화 없는 코드 재배치 (이름 변경, 메서드 추출, 파일 이동 등)
  2. 행위적 변경: 실제 기능 추가/수정
- 구조적 변경과 행위적 변경을 하나의 커밋에 섞지 않는다.
- 둘 다 필요하면 구조적 변경을 먼저 수행한다.
- 구조적 변경 전/후 테스트로 동작 불변을 확인한다.

## 5) 커밋 규율

- 아래 조건을 모두 만족할 때만 커밋한다.
  1. 모든 테스트 통과
  2. 컴파일러/린터 경고 해소
  3. 단일 논리 작업 단위
  4. 커밋 메시지에 구조적/행위적 변경 여부 명시
- 큰 커밋보다 작은 커밋을 자주 수행한다.

## 6) 코드 품질 기준

- 중복을 제거한다.
- 이름과 구조로 의도를 명확히 드러낸다.
- 의존성을 명시적으로 관리한다.
- 함수/메서드는 작고 단일 책임을 갖게 유지한다.
- 상태와 부작용을 최소화한다.
- 항상 "작동하는 가장 단순한 해법"을 선택한다.

## 7) 리팩터링 규칙

- 테스트가 Green일 때만 리팩터링한다.
- 표준 리팩터링 패턴을 사용하고 한 번에 한 가지씩 적용한다.
- 리팩터링 단계마다 테스트를 실행한다.
- 중복 제거와 가독성 향상에 우선순위를 둔다.

## 8) 기본 작업 루프

1. 작은 실패 테스트 작성
2. 최소 구현으로 테스트 통과
3. 테스트 실행으로 Green 확인
4. 필요 시 구조 개선 (각 단계마다 테스트)
5. 구조적 변경은 별도 커밋
6. 다음 작은 테스트 추가
7. 기능 완료 시까지 반복

## 9) 테스트 실행 원칙

- 각 사이클마다 장시간 테스트를 제외한 전체 테스트를 실행한다.
- 실패를 방치한 상태로 다음 단계로 넘어가지 않는다.
